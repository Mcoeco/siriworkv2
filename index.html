<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</title>
<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; padding:20px;}
.container {max-width:1200px; margin:0 auto; background:white; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.1); overflow:hidden;}
.header {background:#1e3c72; color:white; padding:30px; text-align:center; position:relative;}
.header h1 {font-size:2em; margin-bottom:10px;}
.header p {opacity:0.9;}
.nav-tabs {display:flex; justify-content:center; background:#f8f9fa; border-bottom:1px solid #ddd; flex-wrap:wrap;}
.nav-tab {padding:15px 25px; border:none; cursor:pointer; background:none; color:#555; font-weight:500; transition:all 0.3s; border-bottom:3px solid transparent;}
.nav-tab.active {color:#1e3c72; border-bottom:3px solid #1e3c72;}
.nav-tab:hover{background:#e9ecef;}
.content {padding:30px;}
.tab-content {display:none;}
.tab-content.active {display:block;}
.form-group {margin-bottom:15px;}
.form-group label{display:block;margin-bottom:5px;font-weight:600;}
.form-group input, .form-group textarea, .form-group select{width:100%; padding:10px; border-radius:6px; border:1px solid #ccc;}
.btn{padding:8px 15px; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin-right:5px;}
.btn-primary{background:#1e3c72;color:white;}
.btn-success{background:#28a745;color:white;}
.btn-warning{background:#ffc107;color:white;}
.btn-danger{background:#dc3545;color:white;}
.document-card{border:1px solid #ddd; border-radius:8px; padding:15px; margin-bottom:10px; background:white;}
.document-header{display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:10px;}
.document-number{font-weight:bold; color:#1e3c72;}
.status-badge{padding:4px 8px; border-radius:12px; font-size:12px;}
.status-received{background:#d4edda;color:#155724;}
.status-sent{background:#cce5ff;color:#004085;}
.document-details{display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:10px;}
.detail-label{font-size:12px;color:#666;}
.detail-value{font-weight:500;}
.search-box{position:relative;margin-bottom:20px;}
.search-input{width:100%; padding:10px 35px 10px 10px; border-radius:20px; border:1px solid #ccc;}
.search-icon{position:absolute; right:10px; top:50%; transform:translateY(-50%);}
.alert{padding:10px; border-radius:6px; margin-bottom:15px; display:none;}
.alert.show{display:block;}
.alert-success{background:#d4edda; color:#155724;}
.alert-error{background:#f8d7da; color:#721c24;}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h1>
    <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏†‡∏π‡∏ò‡∏£‡∏ô‡πà‡∏≤‡∏ô | ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
    <div id="dbStatus" style="position:absolute;top:10px;right:20px;font-size:12px;"></div>
  </div>

  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showTab('search')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
    <button class="nav-tab" onclick="showTab('stats')">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</button>
  </div>

  <div class="content">
    <div id="alert" class="alert"></div>

    <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
    <div id="search" class="tab-content active">
      <div class="search-box">
        <input type="text" id="searchInput" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô">
        <span class="search-icon">üîç</span>
      </div>
      <div style="margin-bottom:10px;">
        <button class="btn btn-primary" onclick="filterDocuments('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="btn btn-success" onclick="filterDocuments('received')">‡∏£‡∏±‡∏ö</button>
        <button class="btn btn-warning" onclick="filterDocuments('sent')">‡∏™‡πà‡∏á</button>
        <button class="btn btn-primary" onclick="refreshDocuments()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
      </div>
      <div id="documentsList"></div>
    </div>

    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å -->
    <div id="stats" class="tab-content">
      <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</h2>
      <button class="btn btn-primary" onclick="exportDataMenu()">üìÅ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const supabaseUrl = 'https://kowaztnpsharqdroiliv.supabase.co';
const supabaseKey = 'YOUR_SUPABASE_KEY';
const db = createClient(supabaseUrl, supabaseKey);

let documents = [];
let currentFilter='all';

async function testConnection(){
  try {
    const { error } = await db.from('documents').select('*').limit(1);
    document.getElementById('dbStatus').innerHTML = error ? 'üî¥ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠' : 'üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
    return !error;
  } catch(e){ document.getElementById('dbStatus').innerHTML='üî¥ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'; return false; }
}

function showAlert(msg,type='success'){ const a=document.getElementById('alert'); a.textContent=msg; a.className=`alert alert-${type} show`; setTimeout(()=>a.classList.remove('show'),3000); }

function showTab(name){ document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active')); document.getElementById(name).classList.add('active'); document.querySelector(`[onclick="showTab('${name}')"]`).classList.add('active'); if(name==='search') loadDocuments(); }

async function loadDocuments(){
  try{
    const { data, error } = await db.from('documents').select('*').order('created_at',{ascending:false});
    if(error) throw error;
    documents = data || [];
    displayDocuments();
  } catch(err){ showAlert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: '+err.message,'error'); }
}

function displayDocuments(){
  const searchTerm=document.getElementById('searchInput')?.value.toLowerCase()||'';
  const container=document.getElementById('documentsList');
  let filtered = documents;
  if(currentFilter==='received') filtered=documents.filter(d=>d.type==='received');
  else if(currentFilter==='sent') filtered=documents.filter(d=>d.type==='sent');
  if(searchTerm) filtered=filtered.filter(d=>d.doc_number.toLowerCase().includes(searchTerm)||d.subject.toLowerCase().includes(searchTerm)||d.organization.toLowerCase().includes(searchTerm));
  if(filtered.length===0){ container.innerHTML='<div style="text-align:center;color:#666;padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</div>'; return; }
  container.innerHTML=filtered.map(d=>`
  <div class="document-card">
    <div class="document-header">
      <div class="document-number">${d.doc_number}</div>
      <div class="status-badge status-${d.type==='received'?'received':'sent'}">${d.type==='received'?'üì• ‡∏£‡∏±‡∏ö':'üì§ ‡∏™‡πà‡∏á'}</div>
      <div>
        <button class="btn btn-warning" onclick="editDocument(${d.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn btn-danger" onclick="deleteDocument(${d.id})">üóëÔ∏è ‡∏•‡∏ö</button>
      </div>
    </div>
    <div class="document-details">
      <div><div class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div><div class="detail-value">${new Date(d.document_date).toLocaleDateString('th-TH')}</div></div>
      <div><div class="detail-label">${d.type==='received'?'‡∏à‡∏≤‡∏Å':'‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á'}</div><div class="detail-value">${d.organization}</div></div>
      <div><div class="detail-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div><div class="detail-value">${d.doc_type}</div></div>
    </div>
    <div><div class="detail-label">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div><div class="detail-value">${d.subject}</div></div>
  </div>`).join('');
}

async function deleteDocument(id){
  if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
    try{
      const { error } = await db.from('documents').delete().eq('id',id);
      if(error) throw error;
      await loadDocuments(); showAlert('üóëÔ∏è ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß','success');
    } catch(err){ showAlert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+err.message,'error'); }
  }
}

async function editDocument(id){
  const doc = documents.find(d=>d.id===id);
  if(!doc) return showAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£','error');
  const newNumber = prompt('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:',doc.doc_number); if(newNumber===null) return;
  const newSubject = prompt('‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:',doc.subject); if(newSubject===null) return;
  try{
    const { error } = await db.from('documents').update({doc_number:newNumber, subject:newSubject}).eq('id',id);
    if(error) throw error;
    await loadDocuments(); showAlert('‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß','success');
  } catch(err){ showAlert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+err.message,'error'); }
}

function filterDocuments(f){ currentFilter=f; displayDocuments(); }
function refreshDocuments(){ loadDocuments(); showAlert('üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏•‡πâ‡∏ß'); }

function exportDataMenu(){
  const type = prompt('‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå: json / html / csv / txt / print','json');
  if(!type) return;
  switch(type.toLowerCase()){
    case 'json': exportJSON(); break;
    case 'html': exportHTML(); break;
    case 'csv': exportCSV(); break;
    case 'txt': exportTXT(); break;
    case 'print': window.print(); break;
    default: showAlert('‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö','error');
  }
}

function exportJSON(){ downloadBlob(new Blob([JSON.stringify(documents,null,2)],{type:'application/json'}),'documents.json'); }
function exportHTML(){ let html='<table border="1"><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏à‡∏≤‡∏Å/‡∏ñ‡∏∂‡∏á</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th></tr>'; documents.forEach(d=>{ html+=`<tr><td>${d.doc_number}</td><td>${d.subject}</td><td>${d.document_date}</td><td>${d.organization}</td><td>${d.doc_type}</td></tr>`;}); downloadBlob(new Blob([html],{type:'text/html'}),'documents.html'); }
function exportCSV(){ let csv='‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà,‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏à‡∏≤‡∏Å/‡∏ñ‡∏∂‡∏á,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó\n'; documents.forEach(d=>{ csv+=`${d.doc_number},"${d.subject}",${d.document_date},${d.organization},${d.doc_type}\n`; }); downloadBlob(new Blob([csv],{type:'text/csv'}),'documents.csv'); }
function exportTXT(){ let txt=''; documents.forEach(d=>{ txt+=`‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${d.doc_number}\n‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${d.subject}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${d.document_date}\n‡∏à‡∏≤‡∏Å/‡∏ñ‡∏∂‡∏á: ${d.organization}\n‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${d.doc_type}\n------------------\n`;}); downloadBlob(new Blob([txt],{type:'text/plain'}),'documents.txt'); }
function downloadBlob(blob,filename){ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href); showAlert('üìÅ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); }

document.addEventListener('DOMContentLoaded', async ()=>{
  const connected = await testConnection();
  if(connected) loadDocuments();
  document.getElementById('searchInput').addEventListener('input',displayDocuments);
});
</script>
</body>
</html>
