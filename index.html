<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏†‡∏π‡∏ò‡∏£‡∏ô‡πà‡∏≤‡∏ô</title>
<style>
/* ======= ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏î‡∏¥‡∏° ======= */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#1e3c72 0%,#2a5298 100%); min-height:100vh; padding:20px; }
.container { max-width:1200px; margin:0 auto; background:rgba(255,255,255,0.95); border-radius:15px; box-shadow:0 20px 40px rgba(0,0,0,0.1); overflow:hidden; }
.header { background:linear-gradient(90deg,#1e3c72,#2a5298); color:white; padding:30px; text-align:center; position:relative; }
.header h1 { font-size:2.5em; margin-bottom:10px; position:relative; z-index:1; }
.header p { font-size:1.2em; opacity:0.9; position:relative; z-index:1; }
.nav-tabs { background:#f8f9fa; display:flex; justify-content:center; border-bottom:1px solid #ddd; }
.nav-tab { padding:15px 30px; background:none; border:none; cursor:pointer; font-size:16px; font-weight:500; color:#666; transition:all 0.3s ease; border-bottom:3px solid transparent; }
.nav-tab:hover { background:#e9ecef; color:#1e3c72; }
.nav-tab.active { color:#1e3c72; border-bottom-color:#1e3c72; background:white; }
.content { padding:30px; }
.tab-content { display:none; }
.tab-content.active { display:block; animation:fadeIn 0.5s ease-in; }
@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
.form-group { margin-bottom:20px; }
.form-group label { display:block; margin-bottom:8px; font-weight:600; color:#333; }
.form-group input, .form-group select, .form-group textarea { width:100%; padding:12px; border:2px solid #e1e5e9; border-radius:8px; font-size:14px; transition: all 0.3s ease; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline:none; border-color:#1e3c72; box-shadow:0 0 0 3px rgba(30,60,114,0.1); }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.btn { padding:12px 25px; border:none; border-radius:8px; cursor:pointer; font-size:16px; font-weight:600; transition:all 0.3s ease; display:inline-flex; align-items:center; gap:8px; }
.btn:disabled { opacity:0.6; cursor:not-allowed; }
.btn-primary { background:linear-gradient(135deg,#1e3c72,#2a5298); color:white; }
.btn-primary:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 5px 15px rgba(30,60,114,0.3); }
.btn-success { background:linear-gradient(135deg,#28a745,#20c997); color:white; }
.btn-warning { background:linear-gradient(135deg,#ffc107,#fd7e14); color:white; }
.btn-danger { background:linear-gradient(135deg,#dc3545,#e83e8c); color:white; }
.document-card { background:white; border:1px solid #e1e5e9; border-radius:12px; padding:20px; margin-bottom:15px; box-shadow:0 2px 10px rgba(0,0,0,0.05); transition:all 0.3s ease; }
.document-card:hover { transform:translateY(-3px); box-shadow:0 8px 25px rgba(0,0,0,0.1); }
.document-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px; }
.document-number { font-size:18px; font-weight:bold; color:#1e3c72; }
.status-badge { padding:6px 12px; border-radius:20px; font-size:12px; font-weight:600; text-transform:uppercase; }
.status-received { background:#d4edda; color:#155724; }
.status-sent { background:#cce5ff; color:#004085; }
.document-details { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; margin-bottom:15px; }
.detail-item { display:flex; flex-direction:column; }
.detail-label { font-size:12px; color:#666; margin-bottom:4px; }
.detail-value { font-weight:500; color:#333; }
.search-box { width:100%; max-width:400px; margin:0 auto 30px; position:relative; }
.search-input { width:100%; padding:12px 45px 12px 15px; border:2px solid #e1e5e9; border-radius:25px; font-size:16px; transition: all 0.3s ease; }
.search-input:focus { outline:none; border-color:#1e3c72; box-shadow:0 0 0 3px rgba(30,60,114,0.1); }
.search-icon { position:absolute; right:15px; top:50%; transform:translateY(-50%); color:#666; }
.alert { padding:15px; border-radius:8px; margin-bottom:20px; display:none; }
.alert.show { display:block; animation:slideDown 0.3s ease; }
@keyframes slideDown { from { opacity:0; transform:translateY(-10px);} to { opacity:1; transform:translateY(0);} }
.alert-success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
.alert-error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
.loading { display:none; text-align:center; padding:20px; color:#666; }
.loading.show { display:block; }
@media(max-width:768px){.form-row{grid-template-columns:1fr;}.nav-tabs{flex-wrap:wrap;}.nav-tab{flex:1;min-width:120px;}.document-header{flex-direction:column;align-items:flex-start;}}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üèõÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h1>
        <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏†‡∏π‡∏ò‡∏£‡∏ô‡πà‡∏≤‡∏ô | ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡πà‡∏≤‡∏ô</p>
        <div id="dbStatus" style="position:absolute; top:10px; right:20px; font-size:12px; opacity:0.8;"></div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('register')">üì• ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö</button>
        <button class="nav-tab" onclick="showTab('send')">üì§ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏á</button>
        <button class="nav-tab" onclick="showTab('search')">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
        <button class="nav-tab" onclick="showTab('stats')">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </div>

    <div class="content">
        <div id="alert" class="alert"></div>
        <div id="loading" class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

        <!-- ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö -->
        <div id="register" class="tab-content active">
            <h2 style="margin-bottom:25px; color:#1e3c72;">üì• ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <form id="registerForm">
                <div class="form-row">
                    <div class="form-group"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label><input type="text" id="docNumber" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô.123/2567"></div>
                    <div class="form-group"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</label><input type="date" id="receiveDate" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏à‡∏≤‡∏Å (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)</label><input type="text" id="fromOrg" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á"></div>
                    <div class="form-group"><label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label><select id="docType" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</option>
                        <option value="‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</option>
                        <option value="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</option>
                        <option value="‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</option>
                    </select></div>
                </div>
                <div class="form-group"><label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label><input type="text" id="subject" required placeholder="‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"></div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</label><select id="priority">
                        <option value="‡∏õ‡∏Å‡∏ï‡∏¥">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                        <option value="‡∏î‡πà‡∏ß‡∏ô">‡∏î‡πà‡∏ß‡∏ô</option>
                        <option value="‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å">‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å</option>
                        <option value="‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î">‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
                    </select></div>
                    <div class="form-group"><label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label><input type="text" id="responsible" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö"></div>
                </div>
                <div class="form-group"><label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><textarea id="notes" rows="3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea></div>
                <button type="submit" class="btn btn-primary" id="registerBtn">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>

        <!-- ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏á -->
        <div id="send" class="tab-content">
            <h2 style="margin-bottom:25px; color:#1e3c72;">üì§ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <form id="sendForm">
                <div class="form-row">
                    <div class="form-group"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</label><input type="text" id="sendDocNumber" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô.234/2567"></div>
                    <div class="form-group"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</label><input type="date" id="sendDate" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)</label><input type="text" id="toOrg" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á"></div>
                    <div class="form-group"><label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label><select id="sendDocType" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</option>
                        <option value="‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</option>
                        <option value="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</option>
                        <option value="‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</option>
                    </select></div>
                </div>
                <div class="form-group"><label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label><input type="text" id="sendSubject" required placeholder="‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"></div>
                <div class="form-row">
                    <div class="form-group"><label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</label><select id="sendMethod">
                        <option value="‡∏°‡∏∑‡∏≠">‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠</option>
                        <option value="‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå">‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</option>
                        <option value="‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£">‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</option>
                        <option value="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</option>
                    </select></div>
                    <div class="form-group"><label>‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</label><input type="text" id="sender" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á"></div>
                </div>
                <div class="form-group"><label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><textarea id="sendNotes" rows="3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea></div>
                <button type="submit" class="btn btn-primary" id="sendBtn">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</button>
            </form>
        </div>

        <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
        <div id="search" class="tab-content">
            <h2 style="margin-bottom:25px; color:#1e3c72;">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h2>
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠, ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô...">
                <span class="search-icon">üîç</span>
            </div>
            <div style="margin-bottom:20px; text-align:center;">
                <button class="btn btn-primary" onclick="filterDocuments('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="btn btn-success" onclick="filterDocuments('received')">‡∏£‡∏±‡∏ö</button>
                <button class="btn btn-warning" onclick="filterDocuments('sent')">‡∏™‡πà‡∏á</button>
                <button class="btn btn-primary" onclick="refreshDocuments()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
            </div>
            <div id="documentsList"></div>
        </div>

        <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
        <div id="stats" class="tab-content">
            <h2 style="margin-bottom:25px; color:#1e3c72;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-number" id="totalReceived">0</div><div class="stat-label">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</div></div>
                <div class="stat-card"><div class="stat-number" id="totalSent">0</div><div class="stat-label">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</div></div>
                <div class="stat-card"><div class="stat-number" id="totalDocuments">0</div><div class="stat-label">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
                <div class="stat-card"><div class="stat-number" id="todayCount">0</div><div class="stat-label">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div></div>
            </div>
            <button class="btn btn-primary" onclick="exportData()">üìÅ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const supabaseUrl = 'https://kowaztnpsharqdroiliv.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtvd2F6dG5wc2hhcnFkcm9pbGl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MDg1NDUsImV4cCI6MjA3MzQ4NDU0NX0.xU8TH4rrPkno64oDxvb_lwVWeTJEsmN5DY9vj6dTYEU';
const db = createClient(supabaseUrl, supabaseKey);

let documents = [];
let currentFilter = 'all';
let editingId = null;

// Switch tab
function showTab(tabName){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
}

// Alert
function showAlert(message, type='success'){
    const alertBox = document.getElementById('alert');
    alertBox.className = `alert show alert-${type}`;
    alertBox.textContent = message;
    setTimeout(()=>alertBox.classList.remove('show'), 4000);
}

// Load documents
async function loadDocuments(){
    document.getElementById('loading').classList.add('show');
    let { data, error } = await db.from('documents').select('*').order('id',{ascending:false});
    document.getElementById('loading').classList.remove('show');
    if(error){ showAlert('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
    documents = data;
    displayDocuments();
    updateStats();
}

// Display documents
function displayDocuments(){
    const container = document.getElementById('documentsList');
    container.innerHTML='';
    let filtered = documents.filter(d=>{
        if(currentFilter==='all') return true;
        if(currentFilter==='received') return d.type==='received';
        if(currentFilter==='sent') return d.type==='sent';
    });
    filtered.forEach(doc=>{
        const card = document.createElement('div'); card.className='document-card';
        card.innerHTML=`
        <div class="document-header">
            <div class="document-number">${doc.docNumber}</div>
            <div class="status-badge ${doc.type==='received'?'status-received':'status-sent'}">${doc.type==='received'?'‡∏£‡∏±‡∏ö':'‡∏™‡πà‡∏á'}</div>
        </div>
        <div class="document-details">
            <div class="detail-item"><div class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div><div class="detail-value">${doc.date}</div></div>
            <div class="detail-item"><div class="detail-label">${doc.type==='received'?'‡∏à‡∏≤‡∏Å':'‡∏ñ‡∏∂‡∏á'}</div><div class="detail-value">${doc.org}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div><div class="detail-value">${doc.docType}</div></div>
            <div class="detail-item"><div class="detail-label">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div><div class="detail-value">${doc.subject}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö/‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</div><div class="detail-value">${doc.responsible||doc.sender||'-'}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div><div class="detail-value">${doc.notes||doc.sendNotes||'-'}</div></div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-warning" onclick="editDocument(${doc.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="btn btn-danger" onclick="deleteDocument(${doc.id})">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
        `;
        container.appendChild(card);
    });
}

// Update stats
function updateStats(){
    const totalReceived = documents.filter(d=>d.type==='received').length;
    const totalSent = documents.filter(d=>d.type==='sent').length;
    const todayCount = documents.filter(d=>new Date(d.date).toDateString()===new Date().toDateString()).length;
    document.getElementById('totalReceived').textContent=totalReceived;
    document.getElementById('totalSent').textContent=totalSent;
    document.getElementById('totalDocuments').textContent=documents.length;
    document.getElementById('todayCount').textContent=todayCount;
}

// Filter
function filterDocuments(type){
    currentFilter=type;
    displayDocuments();
}

// Refresh
function refreshDocuments(){ loadDocuments(); document.getElementById('searchInput').value=''; }

// Search
document.getElementById('searchInput').addEventListener('input', (e)=>{
    const q = e.target.value.toLowerCase();
    const container = document.getElementById('documentsList');
    container.innerHTML='';
    documents.filter(d=>{
        return [d.docNumber,d.subject,d.org].some(f=>f?.toLowerCase().includes(q));
    }).forEach(doc=>{
        const card = document.createElement('div'); card.className='document-card';
        card.innerHTML=`
        <div class="document-header">
            <div class="document-number">${doc.docNumber}</div>
            <div class="status-badge ${doc.type==='received'?'status-received':'status-sent'}">${doc.type==='received'?'‡∏£‡∏±‡∏ö':'‡∏™‡πà‡∏á'}</div>
        </div>
        <div class="document-details">
            <div class="detail-item"><div class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div><div class="detail-value">${doc.date}</div></div>
            <div class="detail-item"><div class="detail-label">${doc.type==='received'?'‡∏à‡∏≤‡∏Å':'‡∏ñ‡∏∂‡∏á'}</div><div class="detail-value">${doc.org}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div><div class="detail-value">${doc.docType}</div></div>
            <div class="detail-item"><div class="detail-label">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div><div class="detail-value">${doc.subject}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö/‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</div><div class="detail-value">${doc.responsible||doc.sender||'-'}</div></div>
            <div class="detail-item"><div class="detail-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div><div class="detail-value">${doc.notes||doc.sendNotes||'-'}</div></div>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-warning" onclick="editDocument(${doc.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="btn btn-danger" onclick="deleteDocument(${doc.id})">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
        `;
        container.appendChild(card);
    });
});

// Add/Update Received
document.getElementById('registerForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const docNumber=document.getElementById('docNumber').value;
    const date=document.getElementById('receiveDate').value;
    const org=document.getElementById('fromOrg').value;
    const docType=document.getElementById('docType').value;
    const subject=document.getElementById('subject').value;
    const priority=document.getElementById('priority').value;
    const responsible=document.getElementById('responsible').value;
    const notes=document.getElementById('notes').value;

    if(editingId){
        const { error } = await db.from('documents').update({docNumber,date,org,docType,subject,priority,responsible,notes}).eq('id',editingId);
        if(error){ showAlert('‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
        showAlert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        editingId=null;
    } else {
        const { error } = await db.from('documents').insert([{type:'received',docNumber,date,org,docType,subject,priority,responsible,notes}]);
        if(error){ showAlert('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
        showAlert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }
    e.target.reset();
    loadDocuments();
});

// Add/Update Sent
document.getElementById('sendForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const docNumber=document.getElementById('sendDocNumber').value;
    const date=document.getElementById('sendDate').value;
    const org=document.getElementById('toOrg').value;
    const docType=document.getElementById('sendDocType').value;
    const subject=document.getElementById('sendSubject').value;
    const method=document.getElementById('sendMethod').value;
    const sender=document.getElementById('sender').value;
    const notes=document.getElementById('sendNotes').value;

    if(editingId){
        const { error } = await db.from('documents').update({docNumber,date,org,docType,subject,method,sender,sendNotes:notes}).eq('id',editingId);
        if(error){ showAlert('‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
        showAlert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        editingId=null;
    } else {
        const { error } = await db.from('documents').insert([{type:'sent',docNumber,date,org,docType,subject,method,sender,sendNotes:notes}]);
        if(error){ showAlert('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
        showAlert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }
    e.target.reset();
    loadDocuments();
});

// Edit document
function editDocument(id){
    const doc = documents.find(d=>d.id===id);
    if(!doc) return;
    editingId=id;
    showTab(doc.type==='received'?'register':'send');
    if(doc.type==='received'){
        document.getElementById('docNumber').value=doc.docNumber;
        document.getElementById('receiveDate').value=doc.date;
        document.getElementById('fromOrg').value=doc.org;
        document.getElementById('docType').value=doc.docType;
        document.getElementById('subject').value=doc.subject;
        document.getElementById('priority').value=doc.priority||'‡∏õ‡∏Å‡∏ï‡∏¥';
        document.getElementById('responsible').value=doc.responsible||'';
        document.getElementById('notes').value=doc.notes||'';
    } else {
        document.getElementById('sendDocNumber').value=doc.docNumber;
        document.getElementById('sendDate').value=doc.date;
        document.getElementById('toOrg').value=doc.org;
        document.getElementById('sendDocType').value=doc.docType;
        document.getElementById('sendSubject').value=doc.subject;
        document.getElementById('sendMethod').value=doc.method||'‡∏°‡∏∑‡∏≠';
        document.getElementById('sender').value=doc.sender||'';
        document.getElementById('sendNotes').value=doc.sendNotes||'';
    }
}

// Delete
async function deleteDocument(id){
    if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    const { error } = await db.from('documents').delete().eq('id',id);
    if(error){ showAlert('‚ùå ‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); console.error(error); return;}
    showAlert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    loadDocuments();
}

// Export data (JSON)
function exportData(){
    const dataStr = JSON.stringify(documents,null,2);
    const blob = new Blob([dataStr], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='documents.json'; a.click();
    URL.revokeObjectURL(url);
}

// Initial load
loadDocuments();
</script>
</body>
</html>
